 BigFootGadget_Config = { ["clock"] = { ["theme"] = "clock"; }; }; local BFG_2267dd1e681d91a5ba5e78026ba5ec6f = BLibrary("BEvent"); if (GetLocale() == "zhCN") then BIGFOOTGADGET_TOOLTIP_CLASSICAL_TEXT = "Shift+点击切换为经典模式。"; BIGFOOTGADGET_TOOTLIP_CLOCK_TEXT = "Shift+点击切换为时钟模式。"; BIGFOOTGADGET_CURRENT_TIME_TEXT = "当前时间：%s%d:%02d%s"; BIGFOOTGADGET_CURRENT_AM_PREFIX_TEXT = "上午 "; BIGFOOTGADGET_CURRENT_PM_PREFIX_TEXT = "下午 "; BIGFOOTGADGET_CURRENT_AM_SUFFIX_TEXT = ""; BIGFOOTGADGET_CURRENT_PM_SUFFIX_TEXT = ""; BIGFOOTGADGET_NODE_TITLE_PATTERN = "节点 %d"; BIGFOOTGADGET_NODE_TEXT = "地图标记"; BIGFOOTGADGET_NODE_MESSAGE = "%s已经被设置，坐标为：(%d, %d)。"; BIGFOOTGADGET_GPSBUTTON_TITLE = "坐标显示器"; BIGFOOTGADGET_GPSBUTTON_TEXT = "左键点击可以拖动窗口。\nShift+左键点击可以设置地图坐标。\nShift+右键点击可以重置窗口位置。"; elseif (GetLocale() == "zhTW") then BIGFOOTGADGET_TOOLTIP_CLASSICAL_TEXT = "Shift+點擊切換為經典模式。"; BIGFOOTGADGET_TOOTLIP_CLOCK_TEXT = "Shift+點擊切換為時鐘模式。"; BIGFOOTGADGET_CURRENT_TIME_TEXT = "當前時間：%s%d:%02d%s"; BIGFOOTGADGET_CURRENT_AM_PREFIX_TEXT = "上午 "; BIGFOOTGADGET_CURRENT_PM_PREFIX_TEXT = "下午 "; BIGFOOTGADGET_CURRENT_AM_SUFFIX_TEXT = ""; BIGFOOTGADGET_CURRENT_PM_SUFFIX_TEXT = ""; BIGFOOTGADGET_NODE_TITLE_PATTERN = "節點 %d"; BIGFOOTGADGET_NODE_TEXT = "地圖標記"; BIGFOOTGADGET_NODE_MESSAGE = "%s已經被設置，座標為：(%d, %d)。"; BIGFOOTGADGET_GPSBUTTON_TITLE = "座標顯示器"; BIGFOOTGADGET_GPSBUTTON_TEXT = "左鍵點擊可以拖動視窗。\nShift+左鍵點擊可以設置地圖座標。\nShift+右鍵點擊可以重置視窗位置。"; else BIGFOOTGADGET_TOOLTIP_CLASSICAL_TEXT = "\nShift+Click to switch to classical mode"; BIGFOOTGADGET_TOOTLIP_CLOCK_TEXT = "\nShift+Click to switch to clock mode"; BIGFOOTGADGET_CURRENT_TIME_TEXT = "Current time: %s%d:%02d%s"; BIGFOOTGADGET_CURRENT_AM_PREFIX_TEXT = ""; BIGFOOTGADGET_CURRENT_PM_PREFIX_TEXT = ""; BIGFOOTGADGET_CURRENT_AM_SUFFIX_TEXT = " AM"; BIGFOOTGADGET_CURRENT_PM_SUFFIX_TEXT = " PM"; BIGFOOTGADGET_NODE_TITLE_PATTERN = "Node %d"; BIGFOOTGADGET_NODE_TEXT = "Map Note"; BIGFOOTGADGET_NODE_MESSAGE = "%s has been set, the coordinate is (%d, %d)."; BIGFOOTGADGET_GPSBUTTON_TITLE = "Coord Window"; BIGFOOTGADGET_GPSBUTTON_TEXT = "Left click to move window.\nShift + Left click to set mark of map.\nShift + Right click to reset position."; end BFG_6ae85fdcfffe6853b1ec688388caa1e1 = nil; BFG_ee1b0e389887a69a3ad0df99df644fe4 = nil; local BFG_a44ecbf575d7f2eca081a0592e8d84fa = BLibrary("BInfo", "chat", BIGFOOTGADGET_NODE_TEXT); local function BFG_22877fd80fb5c8c508e98c3ec7a5e807() local BFG_77d93d0fdcdc419256aa5205c0ecfc70 = 0; for BFG_e914904fab9d05d3f54d52bfc31a0f3f=1, GameTooltip:NumLines() do local BFG_aacf928ffa23e474a000b1b6292d02a9 = getglobal("GameTooltipTextLeft"..BFG_e914904fab9d05d3f54d52bfc31a0f3f):GetWidth(); if (BFG_aacf928ffa23e474a000b1b6292d02a9 > BFG_77d93d0fdcdc419256aa5205c0ecfc70) then BFG_77d93d0fdcdc419256aa5205c0ecfc70 = BFG_aacf928ffa23e474a000b1b6292d02a9; end end GameTooltip:SetWidth(BFG_77d93d0fdcdc419256aa5205c0ecfc70 + 18); GameTooltip:SetHeight(GameTooltip:GetHeight() + 14*3) end function BigFootClockButton_OnLoad(self) self.BFG_e06da2c56f1e45102d85f8d5628cc26b = CreateFrame("Frame", nil, self); self.BFG_e06da2c56f1e45102d85f8d5628cc26b:SetWidth(42); self.BFG_e06da2c56f1e45102d85f8d5628cc26b:SetHeight(42); self.BFG_e06da2c56f1e45102d85f8d5628cc26b:SetPoint("CENTER", self,"CENTER", 21, 21); self.BFG_e06da2c56f1e45102d85f8d5628cc26b.BFG_5c387ba3afaf9146175764ba9c988bd4 = self.BFG_e06da2c56f1e45102d85f8d5628cc26b:CreateTexture(nil, "BORDER"); self.BFG_e06da2c56f1e45102d85f8d5628cc26b.BFG_5c387ba3afaf9146175764ba9c988bd4:SetVertexColor(0.8, 0.8, 0.8); self.BFG_e06da2c56f1e45102d85f8d5628cc26b.BFG_5c387ba3afaf9146175764ba9c988bd4:SetTexture("Interface\\TaxiFrame\\UI-Taxi-Line"); self.BFG_e06da2c56f1e45102d85f8d5628cc26b.BFG_f7865900074e23318f1a7d3131a3d027 = self.BFG_e06da2c56f1e45102d85f8d5628cc26b:CreateTexture(nil, "BORDER"); self.BFG_e06da2c56f1e45102d85f8d5628cc26b.BFG_f7865900074e23318f1a7d3131a3d027:SetTexture("Interface\\TaxiFrame\\UI-Taxi-Line"); self.BFG_e06da2c56f1e45102d85f8d5628cc26b.BFG_f7865900074e23318f1a7d3131a3d027:SetVertexColor(0.8, 0.8, 0.8); BigFootClockTexture:SetVertexColor(0.8, 0.8, 0.8); end function BigFootClockButton_OnEnter(self) GameTooltip:SetOwner(self, "ANCHOR_BOTTOMLEFT"); BFG_8662f6d2e8a0ca77d3667c73a3eb1f77(GetGameTime()); end function BFG_8662f6d2e8a0ca77d3667c73a3eb1f77(BFG_c20b168eb6db289beda059819c7ac694, BFG_377682ab4d11f1b730b680e0c65e174c) if(TwentyFourHourTime) then GameTooltip:SetText(format(TIME_TWENTYFOURHOURS, BFG_c20b168eb6db289beda059819c7ac694, BFG_377682ab4d11f1b730b680e0c65e174c)); else local BFG_5535a6993d0bd39b28c25fd6cbf9ce6f = 0; if(BFG_c20b168eb6db289beda059819c7ac694 >= 12) then BFG_5535a6993d0bd39b28c25fd6cbf9ce6f = 1; end if(BFG_c20b168eb6db289beda059819c7ac694 > 12) then BFG_c20b168eb6db289beda059819c7ac694 = BFG_c20b168eb6db289beda059819c7ac694 - 12; end if(BFG_c20b168eb6db289beda059819c7ac694 == 0) then BFG_c20b168eb6db289beda059819c7ac694 = 12; end if(BFG_5535a6993d0bd39b28c25fd6cbf9ce6f == 0) then GameTooltip:SetText(format(BIGFOOTGADGET_CURRENT_TIME_TEXT, BIGFOOTGADGET_CURRENT_AM_PREFIX_TEXT, BFG_c20b168eb6db289beda059819c7ac694, BFG_377682ab4d11f1b730b680e0c65e174c, BIGFOOTGADGET_CURRENT_AM_SUFFIX_TEXT)); else GameTooltip:SetText(format(BIGFOOTGADGET_CURRENT_TIME_TEXT, BIGFOOTGADGET_CURRENT_PM_PREFIX_TEXT, BFG_c20b168eb6db289beda059819c7ac694, BFG_377682ab4d11f1b730b680e0c65e174c, BIGFOOTGADGET_CURRENT_PM_SUFFIX_TEXT)); end if (BigFootGadget_Config["clock"]["theme"] == "classical") then GameTooltip:AddLine("\n"..TIMEMANAGER_TOOLTIP_TOGGLE_CLOCK_SETTINGS, 0.8, 0.8, 0.8); GameTooltip:AddLine(BIGFOOTGADGET_TOOTLIP_CLOCK_TEXT, 0.8, 0.8, 0.8); else GameTooltip:AddLine("\n"..TIMEMANAGER_TOOLTIP_TOGGLE_CLOCK_SETTINGS, 0.8, 0.8, 0.8); GameTooltip:AddLine(BIGFOOTGADGET_TOOLTIP_CLASSICAL_TEXT, 0.8, 0.8, 0.8); end BFG_22877fd80fb5c8c508e98c3ec7a5e807(); end end function BigFootClockButton_OnLeave(self) GameTooltip:Hide(); end function BigFootClockButton_OnUpdate(self, BFG_0160ce060565362532dda1b97095ec1d) self.BFG_08610c24afd0471bb34aa92ab39f1a34 = (self.BFG_08610c24afd0471bb34aa92ab39f1a34 or 0) + BFG_0160ce060565362532dda1b97095ec1d; if (self.BFG_08610c24afd0471bb34aa92ab39f1a34 >= 1 or BFG_6ae85fdcfffe6853b1ec688388caa1e1) then BFG_6ae85fdcfffe6853b1ec688388caa1e1 = nil; if (BigFootGadget_Config["clock"]["theme"] == "classical") then self:SetAlpha(0); elseif (BigFootGadget_Config["clock"]["theme"] == "clock") then self:SetAlpha(1); BigFootClockTexture:SetVertexColor(0.8, 0.8, 0.8); local hour, minute = GetGameTime(); if (self.BFG_5c387ba3afaf9146175764ba9c988bd4 ~= hour or mod(minute,12) == 0) then self.BFG_5c387ba3afaf9146175764ba9c988bd4 = hour; DrawRouteLine(self.BFG_e06da2c56f1e45102d85f8d5628cc26b.BFG_5c387ba3afaf9146175764ba9c988bd4, self.BFG_e06da2c56f1e45102d85f8d5628cc26b, -2*cos(90-hour*30-minute/2), -2*sin(90-hour*30-minute/2), 8*cos(90-hour*30-minute/2), 8*sin(90-hour*30-minute/2), 32); end if (self.BFG_f7865900074e23318f1a7d3131a3d027 ~= minute) then self.BFG_f7865900074e23318f1a7d3131a3d027 = minute; DrawRouteLine(self.BFG_e06da2c56f1e45102d85f8d5628cc26b.BFG_f7865900074e23318f1a7d3131a3d027, self.BFG_e06da2c56f1e45102d85f8d5628cc26b, -4*cos(90-minute*6), -4*sin(90-minute*6), 13*cos(90-minute*6), 13*sin(90-minute*6), 24); end end self.BFG_08610c24afd0471bb34aa92ab39f1a34 = 0; end end function BigFootClockButton_OnClick(self, BFG_99f3cf2c6f1fdfadb0fd4ab6e0843bf5) if (IsShiftKeyDown()) then if (BigFootGadget_Config["clock"]["theme"] == "classical") then BigFootGadget_Config["clock"]["theme"] = "clock"; elseif (BigFootGadget_Config["clock"]["theme"] == "clock") then BigFootGadget_Config["clock"]["theme"] = "classical"; end BFG_6ae85fdcfffe6853b1ec688388caa1e1 = true; GameTooltip:SetOwner(self, "ANCHOR_BOTTOMLEFT"); BFG_8662f6d2e8a0ca77d3667c73a3eb1f77(GetGameTime()); else ToggleTimeManager(); end end function BigFootClock_Toggle(switch) if (switch) then BigFootClockButton:Show(); else BigFootClockButton:Hide(); end end function BigFootClock_VisibleHook() if (BFG_ee1b0e389887a69a3ad0df99df644fe4) then TimeManagerClockButton.original_hide(TimeManagerClockButton); else TimeManagerClockButton.original_show(TimeManagerClockButton); end end function BigFootClock_HookClockVisible() if (not BFG_15f7092b8308c1093956d5f53eeecd73) then TimeManagerClockButton.original_show = TimeManagerClockButton.Show; TimeManagerClockButton.original_hide = TimeManagerClockButton.Hide; hooksecurefunc(TimeManagerClockButton, "Show", BigFootClock_VisibleHook); hooksecurefunc(TimeManagerClockButton, "Hide", BigFootClock_VisibleHook); BFG_15f7092b8308c1093956d5f53eeecd73 = true; TimeManagerClockButton:Show(); end end function BFG_2267dd1e681d91a5ba5e78026ba5ec6f.ADDON_LOADED() if (arg1 == "Blizzard_TimeManager") then BigFootClock_HookClockVisible(); end end function BigFootClock_ToggleDefaultClock(switch) if (TimeManagerClockButton) then BigFootClock_HookClockVisible(); else BFG_2267dd1e681d91a5ba5e78026ba5ec6f:RegisterEvent("ADDON_LOADED"); end if (switch) then BFG_ee1b0e389887a69a3ad0df99df644fe4 = false; TimeManagerClockButton:Show(); else BFG_ee1b0e389887a69a3ad0df99df644fe4 = true; TimeManagerClockButton:Hide(); end end function BigFootGPS_Toggle(switch) if (switch) then BigFootGPSButton:Show(); MiniMapMailFrame:ClearAllPoints(); MiniMapMailFrame:SetPoint("TOPRIGHT", "Minimap", "TOPRIGHT", 25, -60); else BigFootGPSButton:Hide(); MiniMapMailFrame:ClearAllPoints(); MiniMapMailFrame:SetPoint("TOPRIGHT", "Minimap", "TOPRIGHT", 21, -38); end end function BigFootGPSButton_OnLoad(self) RegisterForSaveFrame(self); end function BigFootGPSButton_OnEnter(self) local BFG_cd4610f0f4e0972dd0ded1551d2642b9, BFG_1247f6a55aec47e8befd542ab47db187 = IsInInstance(); if (not BFG_cd4610f0f4e0972dd0ded1551d2642b9) then BigFootGPSText:SetTextColor(1.0, 1.0, 1.0); end BigFoot_ShowNewbieTooltip(BIGFOOTGADGET_GPSBUTTON_TITLE, BIGFOOTGADGET_GPSBUTTON_TEXT); end function BigFootGPSButton_ResetPosition() BigFootGPSButton:ClearAllPoints(); BigFootGPSButton:SetPoint("TOP", BigFootClockButton, "BOTTOM", 0, 5); BigFootGPSButton:StopMovingOrSizing(); end function BigFootGPSButton_OnMouseDown(self, BFG_99f3cf2c6f1fdfadb0fd4ab6e0843bf5) local BFG_cd4610f0f4e0972dd0ded1551d2642b9, BFG_1247f6a55aec47e8befd542ab47db187 = IsInInstance(); if (not BFG_cd4610f0f4e0972dd0ded1551d2642b9 and MapPlus_SetNode and MapPlus_SetNode) then BigFootGPSText:SetPoint("CENTER", BigFootGPSButton, "CENTER", 0, 0); end if (IsShiftKeyDown()) then if (BFG_99f3cf2c6f1fdfadb0fd4ab6e0843bf5 == "RightButton") then BigFootGPSText:SetPoint("CENTER", BigFootGPSButton, "CENTER", 0, 0); BigFootGPSButton_ResetPosition(); end else if (BFG_99f3cf2c6f1fdfadb0fd4ab6e0843bf5 == "LeftButton") then BigFootGPSText:SetPoint("CENTER", BigFootGPSButton, "CENTER", 0, 0); self:StartMoving(); self.moving = true; end end end function BigFootGPSButton_OnMouseUp(self, BFG_99f3cf2c6f1fdfadb0fd4ab6e0843bf5) BigFootGPSText:SetPoint("CENTER", BigFootGPSButton, "CENTER", -1, 1); if (not self.moving and BFG_99f3cf2c6f1fdfadb0fd4ab6e0843bf5 == "LeftButton") then local BFG_cd4610f0f4e0972dd0ded1551d2642b9, BFG_1247f6a55aec47e8befd542ab47db187 = IsInInstance(); if (not BFG_cd4610f0f4e0972dd0ded1551d2642b9 and MapPlus_AddNode and MapPlus_SetNode) then SetMapToCurrentZone(); local BFG_488912f110c4e8d4874d4ea4cecca0ef, BFG_311d987bc290a658ced7c041180289f6 = GetMapInfo(); local BFG_b254e387cf58e982ba24fcb3e8a63995, BFG_a0f453fd098c0b0fda780f69cda6ffbf = GetPlayerMapPosition("player"); local BFG_56b8bf66156a2ee3b5aa8cf4c26917b0 = WorldMapDetailFrame:GetWidth()*BFG_b254e387cf58e982ba24fcb3e8a63995; local BFG_8f86fda916deaf021e6f27aa598fa9d7 = -WorldMapDetailFrame:GetHeight()*BFG_a0f453fd098c0b0fda780f69cda6ffbf; BFG_b254e387cf58e982ba24fcb3e8a63995 = math.floor(BFG_b254e387cf58e982ba24fcb3e8a63995*100+0.5); BFG_a0f453fd098c0b0fda780f69cda6ffbf = math.floor(BFG_a0f453fd098c0b0fda780f69cda6ffbf*100+0.5); local __index = MapPlus_AddNode(BFG_488912f110c4e8d4874d4ea4cecca0ef, BFG_56b8bf66156a2ee3b5aa8cf4c26917b0, BFG_8f86fda916deaf021e6f27aa598fa9d7); local BFG_f4e13e8ecf20422833dd2d694a22bf40 = 1; local BFG_12e49080c26b8b9fdea4fa8965254f05 = string.format(BIGFOOTGADGET_NODE_TITLE_PATTERN, __index); if (__index and BFG_f4e13e8ecf20422833dd2d694a22bf40) then MapPlus_SetNode(BFG_488912f110c4e8d4874d4ea4cecca0ef, __index, "title", BFG_12e49080c26b8b9fdea4fa8965254f05); MapPlus_SetNode(BFG_488912f110c4e8d4874d4ea4cecca0ef, __index, "note", ""); MapPlus_SetNode(BFG_488912f110c4e8d4874d4ea4cecca0ef, __index, "type", BFG_f4e13e8ecf20422833dd2d694a22bf40); MapPlus_SetNode(BFG_488912f110c4e8d4874d4ea4cecca0ef, __index, "flash", 1); MapPlus_ShowNode(BFG_488912f110c4e8d4874d4ea4cecca0ef, __index); BFG_a44ecbf575d7f2eca081a0592e8d84fa:Print(string.format(BIGFOOTGADGET_NODE_MESSAGE, BFG_12e49080c26b8b9fdea4fa8965254f05, BFG_b254e387cf58e982ba24fcb3e8a63995, BFG_a0f453fd098c0b0fda780f69cda6ffbf)); end end end if (self.moving) then self:StopMovingOrSizing(); self.moving = nil; end end function BigFootGPSButton_OnLeave(self) BigFootGPSText:SetTextColor(1.0, 0.82, 0); BigFoot_HideNewbieTooltip(); end function BigFootGPSButton_OnUpdate(self, BFG_0160ce060565362532dda1b97095ec1d) self.BFG_08610c24afd0471bb34aa92ab39f1a34 = (self.BFG_08610c24afd0471bb34aa92ab39f1a34 or 0) + BFG_0160ce060565362532dda1b97095ec1d; if (self.BFG_08610c24afd0471bb34aa92ab39f1a34 >= 1 and not WorldMapFrame:IsVisible()) then local BFG_b254e387cf58e982ba24fcb3e8a63995, BFG_a0f453fd098c0b0fda780f69cda6ffbf = GetPlayerMapPosition("player"); local BFG_cd4610f0f4e0972dd0ded1551d2642b9, BFG_1247f6a55aec47e8befd542ab47db187 = IsInInstance(); BFG_b254e387cf58e982ba24fcb3e8a63995 = math.floor(BFG_b254e387cf58e982ba24fcb3e8a63995*100+0.5); BFG_a0f453fd098c0b0fda780f69cda6ffbf = math.floor(BFG_a0f453fd098c0b0fda780f69cda6ffbf*100+0.5); local BFG_e6955c64cf39bdb23dc86de1a9ec2117; if (BFG_cd4610f0f4e0972dd0ded1551d2642b9) then BFG_e6955c64cf39bdb23dc86de1a9ec2117 = string.format("%s,%s", "-", "-"); else BFG_e6955c64cf39bdb23dc86de1a9ec2117 = string.format("%d,%d", BFG_b254e387cf58e982ba24fcb3e8a63995, BFG_a0f453fd098c0b0fda780f69cda6ffbf); end BigFootGPSText:SetText(BFG_e6955c64cf39bdb23dc86de1a9ec2117); self.BFG_08610c24afd0471bb34aa92ab39f1a34 = 0; end end
